@using LoginStartMenu.Models.Entity
@model IEnumerable<LoginStartMenu.Models.Entity.Utente>

@{
    string GetImmagineDaMostrare(Immagine immagine)
    {
        return immagine?.Img1 != null
            ? $"data:image/jpeg;base64,{Convert.ToBase64String(immagine.Img1)}"
            : "/placeholder.jpg"; // Immagine di placeholder
    }

    List<string> GetImmagini(Immagine immagine)
    {
        var immagini = new List<string>();
        if (immagine == null) return immagini;

        if (immagine.Img1 != null)
            immagini.Add($"data:image/jpeg;base64,{Convert.ToBase64String(immagine.Img1)}");
        if (immagine.Img2 != null)
            immagini.Add($"data:image/jpeg;base64,{Convert.ToBase64String(immagine.Img2)}");
        if (immagine.Img3 != null)
            immagini.Add($"data:image/jpeg;base64,{Convert.ToBase64String(immagine.Img3)}");

        return immagini;
    }
}

<style>
    .user-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        padding: 20px;
    }

    .image-box {
        width: 250px;
        height: 250px;
        border: 1px solid #ccc;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
        background-color: #f0f0f0; /* Placeholder */
    }

    .user-image {
        width: 100%;
        height: 100%;
        object-fit: cover; /* Mantiene le proporzioni */
        transition: opacity 0.3s;
    }
</style>

<div class="user-gallery">
    @foreach (var user in Model)
    {
        var immagini = GetImmagini(user.Immagine);
        var primaImmagine = GetImmagineDaMostrare(user.Immagine);

        <div class="image-box"
             onmouseover="startSlideshow(this)"
             onmouseout="stopSlideshow(this)">
            <img class="user-image"
                 src="@primaImmagine"
                 alt="@user.Username"
                 data-images='@Json.Serialize(immagini)'>
        </div>
    }
</div>

<script>
    function startSlideshow(element) {
        const imgElement = element.querySelector('.user-image');
        const images = JSON.parse(imgElement.dataset.images);

        if (images.length < 2) return;

        let index = 0;
        element.slideshowInterval = setInterval(() => {
            index = (index + 1) % images.length;
            imgElement.src = images[index];
        }, 2000);
    }

    function stopSlideshow(element) {
        clearInterval(element.slideshowInterval);
    }
</script>